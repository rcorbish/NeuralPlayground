extends layout

block content

	h1 Model layers

	.upload( data-target='upload-train' ) training data

	.upload( data-target='upload-test' ) test data			

	a( href='config.json', target='_blank' )
		.upload( data-target='upload-config' ) configuration			

	.design
		form#create-nn( method='post')
			select(name='layer-type', placeholder='Number of layers' )
				option(value='MLP') Multi Layer Perceptron
				option(value='W2V') Word to vector
				option(value='DBN') Restricted Boltzmann Machine
				option(value='DBNA') Deep Belief Autoencoder
				option(value='LSTM') Long Short Term Memory
			input(type='number', name='num-layers', placeholder='Number of layers', min=1  )
			input(type='number', name='num-inputs', placeholder='Number of data inputs', min=2  )
			input(type='number', name='num-outputs', placeholder='Number of data outputs', min=2  )
			input(type='submit', value='Build my network')
		
	#results
		
	script
		document.getElementById( 'create-nn' ).onsubmit = function() {
			var xhr = new XMLHttpRequest();	
			xhr.onload = function(e) {
				document.getElementById( "results" ).innerHTML = "<pre>" + e.target.responseText + "</pre>";
			} ;
						
			xhr.open("POST", 'create' );
			xhr.send( new FormData(this) );
			return false ;
		}
		
		function initUploadDivs() {
			var divs = document.querySelectorAll( ".upload" ) ;
			var div ;
			for( var i=0 ; i<divs.length ; i++ ) {
				div = divs[i] ;
				div.ondragover = function (e) { 
					e.dataTransfer.dropEffect = 'copy';
					this.className = "upload dropok" ; 
					e.preventDefault();
					return false; 
				}.bind( div ) ;
				div.ondragend = function () { 
					this.className = "upload" ; 
					e.preventDefault();
					return false; 
				};
				div.ondragleave = function () { 
					this.className = "upload" ; 
					e.preventDefault();
					return false; 
				};
				div.ondrop = function (e) {
					this.className = "upload" ; 
					e.preventDefault();
					
					var file = e.dataTransfer.files[0] ;
					var reader = new FileReader();
					
					reader.onload = function (event) {
						var xhr = new XMLHttpRequest();	
						xhr.onload = function(e) {
							document.getElementById( "results" ).innerHTML = "<pre>" + e.target.responseText + "</pre>";
						} ;
									
						xhr.open("POST", this.dataset.target );
						xhr.setRequestHeader("Content-type", "text/csv");
						xhr.send( event.target.result );
					}.bind( this ) ;
					reader.readAsText(file);
					
					return false;
				}.bind( div ) ;
			}
		}
		initUploadDivs() ;